# Check that llvm-bolt processes PIC clang binary and the resulting binary
# correctly compiles a C++ source.

REQUIRES: x86_64-linux

RUN: llvm-bolt %p/Inputs/clang-7.pic -o %t -data %p/Inputs/clang-7.pic.fdata \
RUN:    -relocs -reorder-blocks=cache+ -split-functions=3 -split-all-cold \
RUN:    -split-eh -icf=1 -reorder-functions=hfsort+ -use-gnu-stack \
RUN:    -jump-tables=aggressive -frame-opt=hot -strict \
RUN:    >& %t.log && \
RUN: %t %p/Inputs/clang-7.pic.input.cpp -O2 -c -o %t.out && \
RUN: cmp %p/Inputs/clang-7.pic.input.o %t.out && FileCheck %s -input-file %t.log

CHECK: BOLT-INFO: 14724 out of 59493 functions in the binary (24.7%) have non-empty execution profile
